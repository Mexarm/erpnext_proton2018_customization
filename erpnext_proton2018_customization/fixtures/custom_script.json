[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Production Order", 
  "modified": "2018-04-19 16:41:06.027084", 
  "name": "Production Order-Client", 
  "script": "erpnext.production_order_PL = {\n  set_custom_buttons: function (frm) {\n    var doc = frm.doc;\n    if (doc.docstatus === 1) {\n      if (!frm.doc.skip_transfer) {\n        if (flt(doc.material_transferred_for_manufacturing_impresion) < flt(doc.qty) && frm.doc.status != \"Stopped\") {\n          //frm.has_start_impresion_btn = true;\n          var start_btn = frm.add_custom_button(__(\"Iniciar Impresion\"), function () {\n            erpnext.production_order_PL.make_se(frm, \"Material Transfer for Manufacture\", \"impresion\");\n          });\n          start_btn.addClass(\"btn-warning\");\n        }\n        if (flt(doc.material_transferred_for_manufacturing_produccion) < flt(doc.qty) && frm.doc.status != \"Stopped\") {\n          //frm.has_start_produccion_btn = true;\n          var start_btn2 = frm.add_custom_button(__(\"Iniciar Produccion\"), function () {\n            erpnext.production_order_PL.make_se(frm, \"Material Transfer for Manufacture\", \"produccion\");\n          });\n          start_btn2.addClass(\"btn-info\");\n        }\n      }\n    }\n  },\n  make_se: function (frm, purpose, tipo) {\n    var material_transferred_for_manufacturing = frm.doc[\"material_transferred_for_manufacturing_\" + tipo]; //custom\n\n    if (!frm.doc.skip_transfer) {\n      var max =\n        purpose === \"Manufacture\"\n          ? flt(frm.doc.material_transferred_for_manufacturing) - flt(frm.doc.produced_qty)\n          : flt(frm.doc.qty) - flt(material_transferred_for_manufacturing);\n    } else {\n      var max = flt(frm.doc.qty) - flt(frm.doc.produced_qty);\n    }\n\n    max = flt(max, precision(\"qty\"));\n    frappe.prompt(\n      {\n        fieldtype: \"Float\",\n        label: tipo + \":\" + __(\"Qty for {0}\", [purpose]),\n        fieldname: \"qty\",\n        description: __(\"Max: {0}\", [max]),\n        default: max\n      },\n      function (data) {\n        if (data.qty > max) {\n          frappe.msgprint(__(\"Quantity must not be more than {0}\", [max]));\n          return;\n        }\n        frappe.call({\n          method: \"erpnext_proton2018_customization.erpnext_proton2018_customization.doctype.production_order.production_order.make_stock_entry\",\n          //\"erpnext.manufacturing.doctype.production_order.production_order.make_stock_entry\",\n          args: {\n            production_order_id: frm.doc.name,\n            purpose: purpose,\n            qty: data.qty,\n            tipo: tipo //added\n          },\n          callback: function (r) {\n            var doclist = frappe.model.sync(r.message);\n            frappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n          }\n        });\n      },\n      __(\"Select Quantity\"),\n      __(\"Make\")\n    );\n  }\n};\n//validaciones y onload\ncur_frm.cscript.custom_validate = function (doc) {\n  if (\"wip_warehouse\" in doc) {\n    if (doc.wip_warehouse.indexOf(\"(WIP)\") === -1) {\n      frappe.msgprint(__(\"WIP warehouse not correct\"));\n      frappe.validated = false;\n    }\n  } else {\n    frappe.msgprint(__(\"WIP warehouse is required\"));\n    frappe.validated = false;\n  }\n};\nfrappe.ui.form.on(\"Production Order\", {\n  onload: function (frm, cdt, cdn) {\n    console.log(cdt, cdn);\n    if (!(\"fg_warehouse\" in frm)) {\n      frappe.model.set_value(cdt, cdn, \"fg_warehouse\", \"Productos terminados (FG) - PL\");\n    }\n\n    if (!(\"wip_warehouse\" in frm)) {\n      frappe.model.set_value(cdt, cdn, \"wip_warehouse\", \"Trabajo en proceso (WIP) - PL\");\n    }\n    if (!(\"scrap_warehouse\" in frm)) {\n      frappe.model.set_value(cdt, cdn, \"scrap_warehouse\", \"Desperdicio (SCRAP) - PL\");\n    }\n    frm.set_df_property(\"fg_warehouse\", \"reqd\", 1);\n    frm.set_df_property(\"wip_warehouse\", \"reqd\", 1);\n    frm.set_df_property(\"scrap_warehouse\", \"reqd\", 1);\n\n    erpnext.production_order_PL.set_custom_buttons(frm);\n  }\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2018-04-19 23:22:09.204150", 
  "name": "Stock Entry-Client", 
  "script": "cur_frm.cscript.custom_validate = function (frm, cdt, cdn) {\n  var d = locals[cdt][cdn];\n  console.log(d);\n  if ([\"Material Transfer for Manufacturing\", \"Manufacture\"].indexOf(d.purpose) >= 0) {\n    if (d.hasOwnProperty('production_order') && d['production_order'] === \"\") {\n      console.log('inside error');\n      frappe.msgprint(__(\"Production Order Required for {0}\", [d.purpose]));\n      frappe.validated = false;\n    }\n\n  }\n};\n\nfrappe.ui.form.on(\"Stock Entry\", {\n  onload: function (frm, cdt, cdn) {\n    var d = locals[cdt][cdn];\n    if (d.purpose === \"Material Transfer for Manufacturing\") {\n      var total = 0;\n      $.each(d.items, function (index, row) {\n        frappe.model.get_value(\"Item\", { item_code: row.item_code }, \"print_process_required\", function (d) {\n          row.impresion = d.print_process_required;\n          if (row.impresion === 1) {\n            row.t_warehouse = \"Impresion - WIP - PL\";\n          }\n        });\n      });\n    }\n  }\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Grafica de Impresion", 
  "modified": "2018-04-17 19:25:09.277907", 
  "name": "Grafica de Impresion-Client", 
  "script": "cur_frm.set_query('sales_order', function () {\n    return {\n        filters: {\n            'status': 'To Deliver and Bill'\n        }\n    }\n});\n\ncur_frm.fields_dict['archivos_spool'].grid.get_field('material').get_query = function(doc, cdt, cdn)\n {\n                var d = locals[cdt][cdn];\n                return {\n                    filters: [[\n                            'Item', 'print_process_required', '=', 1\n                    ]]\n                }\n };\n\nfrappe.ui.form.on(\"Grafica de Impresion\", \"validate\", function(frm, cdt, cdn) {\n\t\t//Sum each spool_entry \n   \t\tvar material_details = frm.doc.archivos_spool\n   \t\tvar total = 0\n   \t\tfor(var i in material_details) {\n\t\t\ttotal = total + material_details[i].cantidad_de_registros\n\t\t}\n\t\tfrm.set_value(\"total\",total)\nconsole.log(material_details)\n\n$.each(material_details, function(index, row) {\n      console.log(index,row);\n      frappe.model.get_value(\n        \"Item\",\n        { item_code: row.material },\n        \"print_process_required\",\n        function(d) {\n          console.log(d);\n        }\n      );\n    });\t\t\n\n\n\n\n\t     });\n", 
  "script_type": "Client"
 }
]